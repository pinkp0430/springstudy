<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap>
	<typeAlias type="member.dto.MemberDTO" alias="mdto"/>
	<sql id="select">
		select 	id,
					password,
					name,
					register_number1,
					register_number2 as registerNumber2,
					mileage,
					picture_filename
		from		member
	</sql>
	<!-- resultMapp 설정 -->
	<resultMap id="memberRM" class="mdto">
		<result property="id" columnIndex="1"/>
		<result property="password" columnIndex="2"/>
		<result property="name" columnIndex="3"/>
		<result property="registerNumber1" columnIndex="4"/>
		<result property="registerNumber2" columnIndex="5"/>
		<result property="mileage" columnIndex="6" nullValue="-1"/>
		<result property="pictureFilename" columnIndex="7"/>
	</resultMap>
	
	<!-- insert태그 작성 -->
	<insert id="insertMember" parameterClass="mdto">
		insert into member(id, password, name, register_number1, register_number2, 
									  mileage, picture_filename)
		values(#id#,#password#,#name#, #registerNumber1#,#registerNumber2#,
			       #mileage#, #pictureFilename#)
				   
	</insert>
	<!-- select태그 작성 -->
	<select id="selectMemberById"  resultMap="memberRM">
		<include refid="select"/>
		where	id=#value#				
	</select>
	<!-- 주민번호로 조회 -->
	<select id="selectMemberByRegisterNumber" 
				parameterClass="hashmap"
				resultMap="memberRM">
		<include refid="select"/>
		where	register_number1 = #registerNumber1#
		and		register_number2 = #registerNumber2#
	</select>
	<!-- 전체 회원정보 조회 -->
	<select id="selectAllMember" resultMap="memberRM">
		<include refid="select"/>
	</select>
	<!-- update -->
	<update id="updateMemberById" parameterClass="mdto">
		update	member
		 set		password=#password#,
		 			name=#name#,
		 			register_number1=#registerNumber1#,
		 			register_number2=#registerNumber2#,
		 			picture_filename = #pictureFilename#
		where	id=#id#		 			
	</update>
	<!-- 삭제 -->
	<delete id="deleteMemberById">
		delete  from member
		where	id=#id#
	</delete>
	<select id="selectMemberByMileageRange" parameterClass="hashmap"
				resultMap="memberRM">
		<include refid="select"/>
		<![CDATA[
		where 	mileage >= #sMileage# 
		 and		mileage <= #eMileage#
		 ]]>
	</select>
	<select id="selectMemberByName" resultMap="memberRM">
		<include refid="select"/>
		where name like '%'||#name#||'%'
	</select>
	<!-- 사진 정보 삭제처리 -->
	<update id="updatePictureFilename">
		update 	member
		set		picture_filename=null
		where 	id=#id#
	</update>
</sqlMap>






















